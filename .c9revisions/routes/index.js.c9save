{"ts":1352933263345,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var model = require('../model');\nvar repo = new model.MongoRepository();\n\n// GET /\nexports.index = function(req, res){\n  res.render('index', { title: 'Express' });\n};\n\n//GET /:uuid\nexports.find = function(req, res) {\n\tvar uuid = req.params.uuid;\n\trepo.get(uuid, function(nurl) {\n\t\tconsole.log('Nurl: ' + JSON.stringify(nurl));\n\t\tif (nurl && nurl.Url) {\n\t\t\tres.render('redirect', { title: \"Find URL\", url: nurl.Url });\n\t\t}\n\t\telse {\n\t\t\tres.send('not found');\n\t\t}\n\t});\n};\n\n// POST /\nexports.create = function(req, res) {\n\tvar url = req.body.url;\n\trepo.create(url, function(nurl, err) {\n\t\tif (!err) {\n\t\t\tres.render('created', { title: 'Created URL', oldUrl: nurl.Url, newUrl: 'http://localhost:3000/' + nurl._id });\n\t\t}\n\t\telse {\n\t\t\tres.send('Err: ' + err);\n\t\t}\n\t});\n};\n\n// GET /\nexports.request = function(req, res) {\n\tres.render('request', { title: 'Create URL' });\n};\n\nexports.getsearch = function(req, res) {\n\tres.render('search', { title: 'Search URLs' });\n};\n\nexports.postsearch = function(req, res) {\n\tvar searchPhrase = req.body.query;\n\trepo.search(searchPhrase, function(results) {\n\t\tconsole.log(JSON.stringify(results));\n\t\tif (req.get('Content-Type') == 'application/json') {\n\t\t\tres.send(JSON.stringify(results));\n\t\t}\n\t\telse {\n\t\t\tres.render('search', {title: 'Search URLs', results: results});\n\t\t}\t\t\n\t});\t\n};\n\nexports.delete = function(req, res) {\n\trepo.delete(function() {\n\t\tres.send(\"Successfully deleted\");\n\t});\n};"]],"start1":0,"start2":0,"length1":0,"length2":1422}]],"length":1422}
